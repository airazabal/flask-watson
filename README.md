# Falcon-Watson

This service reads social media posts from authenticated users and returns a Personality Insight JSON generated by Watson PI based on those posts. It requires authorization by the user and the passing of subsequently generated OAuth credentials.

## Instructions to use as REST API

Falcon-Watson is intended to be be accessed as part of the microservice architecture of the Cerebri AI Experience Engine. Following these instructions assumes you have created an OAuth client for the social media platform of your choosing and have successfully authenticated the user. For access to the **app credentials** that are currently registered by Cerebri AI with each social media platform and to **have your client domain whitelisted on the Falcon-Watson server**, please contact the Experience Engine Team.

An exmaple POST request (in Python 2.7) is listed below with options for the different social media platforms. Only one social media platform can be used at a time. It is important to note that a `'Content-Type': 'application/json'` header must be included on the POST request is using a different language or combination of Python packages (it is done automatically in this example). A successful response will return with a Personality Insight JSON.

### Setup
'''python
import requests
flask_watson_url = 'http://flask-watson-dev.mybluemix.net'
'''

### for Facebook
'''python
# oauthToken is the OAuth token
# userID is the alpha-numeric string used by Facebook to identify the user

url = flask_watson_url + '/fb_piroute'
body = {'oauth_token': accessToken, 'user_id': userID}
'''

### for Twitter
'''python
# username is the twitter handle
# token is the OAuth token
# token_key is the OAuth token key

url = flask_watson_url + '/tw_piroute'
body = {'username': username, 'token': token, 'token_key': token_key}
'''

### for Google+
'''python
# access_token is the Oauth token

url = flask_watson_url + '/gp_piroute'
body = {'access_token': access_token}
'''

### POST Request
'''python
r = requests.post(url, json=body)
'''

## Instructions to use sample OAuth clients to simulate log-in

The HTML templates and `oauth_server.py` Python-Flask server in the `tests` directory can be used to simulate an OAuth flow to authenticate a user. This exercise may be helpful to expedite your creation of an OAuth client for yourself. For access to the **app credentials** that are currently registered by Cerebri AI with each social media platform and to **have your client domain whitelisted on the Falcon-Watson server**, please contact the Experience Engine Team.

1. Clone this repository on to your local machine
2. Load the following environment variables into your current local environment:
  - TEST_BACKEND_URL - set this to 'http://flask-watson-dev.mybluemix.net'
  - TW_CONSUMER_KEY - set this to the Twitter consumer key (from EE team)
  - TW_CONSUMER_SECRET - set this to the Twitter consumer key secret (from EE team)
3. Make sure you have the following packages installed in your current Python environment (all can be added using `pip install <package>`:
  - Flask
  - twitter
  - requests
4. Navigate to the `tests` directory in command line
5. Run the server by typing `python oauth_server.py`
6. Open Google Chrome (or another inferior evergreen browser) and head to `http://0.0.0.0:5001` and append the route corresponding to the social media service you wish to experience the OAuth flow for:
  - `/facebook` for Facebook
  - `/twitter` for Twitter
  - `/google` for Google+
7. Open up the browser console
8. Run through the OAuth flow
9. Check the browser console to see when the authorization is completed that the response received is consistent with the Watson PI JSON you expected